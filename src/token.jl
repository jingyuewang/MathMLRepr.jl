# OPERATORS defines single characters that should be converted to an MML
# operator element: <mo></mo>.  There are other MML operators that can not be
# represented by a single ASCII character in TeX, e.g, \{, \}, \subset, \vee,
# \cup, \in, \forall, \approx, etc. They are processed in the command reader.
# chars in BRACKETS are converted to TK_PAREN type which will also be
# converted to <mo> but could carry size attributes.
const OPERATOR_IDS = "+-*/!:=,.\'"
const BRACKETS = "|<>()[]"

# types
# NOTE: Most are not types in TeX, e.g., objects in TK_OPID just represent
# regular symbols in TeX, but they will be converted to operator elements,
# i.e., <mo> elements in MathML
const TK_MATH = 0               # to the top elelment <math>
const TK_ID = 1                 # to <mi>, single-char identifiers
const TK_NUM = 2                # to <mn>
#const TK_SYM = 3               # to <mi> with UCS codepoint literal
const TK_FUN = 4                # to <mi>, multi-char identifiers
#const TK_CMD = 5
const TK_ENV = 6
const TK_OPID = 7               # convert to <mo>
# parenthesis' are also OPIDs. They are a little more special than single-char
# OPIDs in that they are paired, and may be rendered in a specified size when
# a \big TeX command is present (in this case, they are converted to <mo> with
# `maxsize` or `minsize` attributes)
const TK_PAREN = 8
const TK_UNKNOWN = 9
# types that need special layout treatment when sub-sup operators are present.
# TK_LIMs are parsed to TK_FUN, which are ultimately just special identifiers.
# TK_INTs and TK_BIGOPs are parsed to TK_OPID (they are math operator identifiers,
# not true TeX language operators)
const TK_LIM = 33               # \lim, \liminf, ... only subscripts
const TK_INT = 34               # \int, ..., sub-super-scripts
const TK_BIGOP = 35             # \sum, \prod, \bigcup, ..., sub-super-scripts

# TeX language commands, each with its own type
const TK_LBRACE = 11            # '{': initiate an expression group
const TK_RBRACE = 12            # '}': end an expression group
const TK_SUB = 13               # '-': subscript
const TK_SUP = 14               # '^': superscript
const TK_AMP = 15               # '&': ampersand
const TK_NEWLINE = 16           # '\\': new line
const TK_OPNAME = 70            # \operatorname
const TK_TEXT = 41
const TK_SQRT = 42
const TK_FRAC = 43
const TK_LEFT = 44
const TK_RIGHT = 45
const TK_MIDDLE = 46
const TK_BEGIN = 47
const TK_END = 48
const TK_BINOM = 49
const TK_OVERSET = 50
const TK_UNDERSET = 51
const TK_FRACOVER = 52
# TK_OEVRACCENT(TK_UNDERACCENT) are tokens for TeX command: \dot,
# \tilde, \hat, etc. The <mover> (<munder>) element carries an attrubute
# `accent` which is set to be "true", e.g.,
# "\hat{A}" is converted to
#   <mover accent="true">
#     <mi>A</mi>
#     <mo> &#x5E;<!--CIRCUMFLEX ACCENT--></mo>
#   </mover>
const TK_OVERACCENT = 54
const TK_UNDERACCENT = 55
const TK_SPACE = 60
const TK_BIG = 61
# \overbrace (\underbrace) are converted to <mover> (<munder>). They could
# carry a super(sub)-script.
const TK_OVERBRACE = 52
const TK_UNDERBRACE = 53

# other MML operators

# an expression group with specified style
# It seems MathJax does not support mathvariant, we may not implement
# style for now... need to do more experiments.
const TK_STYLE = 100            # \mathrm, \mathcal, ... convert to <mstyle>
const TK_IGSTYLE = 101          # in-group style: \bf, \it, \red, ...
const TK_ENV_NAME = 110         # env-names that follow \begin(\end) commands
const TK_ENV_ATTR = 111         # env-attributes that follow \begin(\end) commands


struct Token
    type::Int
    val::String
end
Token(t::Int, v::Char) = Token(t, string(v))

# symbols are copied from `latex_symbols.jl` in the `REPL` module.
const command_to_token = Dict(
    # styles
    "mathbf"     => Token(TK_STYLE, "mathbf"),
    "mathcal"    => Token(TK_STYLE, "mathcal"),
    "mathbb"     => Token(TK_STYLE, "mathbb"),
    "mathfrak"   => Token(TK_STYLE, "mathfrak"),
    "bigl"       => Token(TK_BIG, "1.2em"),
    "bigr"       => Token(TK_BIG, "1.2em"),
    "Bigl"       => Token(TK_BIG, "1.623em"),
    "Bigr"       => Token(TK_BIG, "1.623em"),
    "biggl"      => Token(TK_BIG, "2.047em"),
    "biggr"      => Token(TK_BIG, "2.047em"),
    "Biggl"      => Token(TK_BIG, "2.470em"),
    "Biggr"      => Token(TK_BIG, "2.470em"),
    "it"         => Token(TK_IGSTYLE, "it"),
    "bf"         => Token(TK_IGSTYLE, "bf"),
    "rm"         => Token(TK_IGSTYLE, "rf"),
    # commands
    "text"          => Token(TK_TEXT, ""),
    "sqrt"          => Token(TK_SQRT, ""),
    "frac"          => Token(TK_FRAC, ""),
    "over"          => Token(TK_FRACOVER, ""),
    "binom"         => Token(TK_BINOM, ""),
    "left"          => Token(TK_LEFT, ""),
    "right"         => Token(TK_RIGHT, ""),
#    "middle"        => Token(TK_MIDDLE, ""),
    "begin"         => Token(TK_BEGIN, ""),
    "end"           => Token(TK_END, ""),
    "overset"       => Token(TK_OVERSET, ""),
    "underset"      => Token(TK_UNDERSET, ""),
    # if \overbrace (\underspace) carries a super-script (sub-script)
    # operator, it has to be dealt with specially as the result is NOT
    # a usual super-scripted (sub-scripted) glyph.
    "overbrace"     => Token(TK_OVERBRACE, '\u23de'),
    "underbrace"    => Token(TK_UNDERBRACE, '\u23df'),
    # operator name
    "operatorname"  => Token(TK_OPNAME, ""),
    # over/under-script operator as accent
    "dot"               => Token(TK_OVERACCENT, 'Àô'),
    "ddot"              => Token(TK_OVERACCENT, '¬®'),
    "bar"               => Token(TK_OVERACCENT, '¬Ø'),
    "hat"               => Token(TK_OVERACCENT, '^'),
    "check"             => Token(TK_OVERACCENT, 'Àá'),
    "breve"             => Token(TK_OVERACCENT, 'Àò'),
    "acute"             => Token(TK_OVERACCENT, '¬¥'),
    "grave"             => Token(TK_OVERACCENT, '`'),
    "tilde"             => Token(TK_OVERACCENT, '~'),
    "vec"               => Token(TK_OVERACCENT, '‚Üí'),
    "overline"          => Token(TK_OVERACCENT, '_'),
    "underline"         => Token(TK_OVERACCENT, '_'),
    "widehat"           => Token(TK_OVERACCENT, '^'),
    "widetilde"         => Token(TK_OVERACCENT, '~'),
    "overrightarrow"    => Token(TK_OVERACCENT, '‚Üí'),
    "overleftarrow"     => Token(TK_OVERACCENT, '‚Üê'),
    # spaces and new-line
    # Space tokens are conveted to <mspace> elements
    # new-line is also converted to <mspace> with `linebreak="newline"`
    "\\"         => Token(TK_NEWLINE, ""),
    "!"          => Token(TK_SPACE, "-0.167em"),    # -3./18.
    ","          => Token(TK_SPACE, "0.167em"),     #  3./18. 
    ":"          => Token(TK_SPACE, "0.222em"),     #  4./18.
    ";"          => Token(TK_SPACE, "0.278em"),     #  5./18"
    " "          => Token(TK_SPACE, "1.0em"),       #  1.
    "quad"       => Token(TK_SPACE, "1.0em"),       #  1.
    "qquad"      => Token(TK_SPACE, "2.0em"),       #  2.
    # parenthesis
    # parenthesis token are converted to either <mo> or <mo> with sizes if
    # \left (\right) command is present
    "langle"     => Token(TK_PAREN, "‚ü®"),
    "rangle"     => Token(TK_PAREN, "‚ü©"),
    "{"          => Token(TK_PAREN, "{"),
    "}"          => Token(TK_PAREN, "}"),
    "lceil"      => Token(TK_PAREN, "‚åà"),
    "rceil"      => Token(TK_PAREN, "‚åâ"),
    "lfloor"     => Token(TK_PAREN, "‚åä"),
    "rfloor"     => Token(TK_PAREN, "‚åã"),
    "|"          => Token(TK_PAREN, '‚à•'),
    # \lim, \int, and \bigop, we might need some special treatment?
    "lim"        => Token(TK_LIM, "lim"),
    "liminf"     => Token(TK_LIM, "lim inf"),
    "limsup"     => Token(TK_LIM, "lim sup"),
    "min"        => Token(TK_LIM, "min"),
    "max"        => Token(TK_LIM, "max"),
    "inf"        => Token(TK_LIM, "inf"),
    "sup"        => Token(TK_LIM, "sup"),
    "int"        => Token(TK_INT, '‚à´'),
    "iint"       => Token(TK_INT, '‚à¨'),
    "iiint"      => Token(TK_INT, '‚à≠'),
    "oint"       => Token(TK_INT, '‚àÆ'),
    "sum"        => Token(TK_BIGOP, '‚àë'),
    "prod"       => Token(TK_BIGOP, '‚àè'),
    "coprod"     => Token(TK_BIGOP, '‚àê'),
    "bigcap"     => Token(TK_BIGOP, '‚ãÇ'),
    "bigcup"     => Token(TK_BIGOP, '‚ãÉ'),
    "bigsqcup"   => Token(TK_BIGOP, '‚®Ü'),
    "bigvee"     => Token(TK_BIGOP, '‚ãÅ'),
    "bigwedge"   => Token(TK_BIGOP, '‚ãÄ'),
    "bigodot"    => Token(TK_BIGOP, '‚®Ä'),
    "bitotimes"  => Token(TK_BIGOP, '‚®Ç'),
    "bigoplus"   => Token(TK_BIGOP, '‚®Å'),
    "biguplus"   => Token(TK_BIGOP, '‚®Ñ'),

    # environments
    "matrix"     => Token(TK_ENV, "matrix"),
    "pmatrix"    => Token(TK_ENV, "pmatrix"),
    "bmatrix"    => Token(TK_ENV, "bmatrix"),
    "vmatrix"    => Token(TK_ENV, "vmatrix"),

    # symbols
    "Alpha"      => Token(TK_ID, 'Œë'),
    "alpha"      => Token(TK_ID, 'Œ±'),
    "Beta"       => Token(TK_ID, 'Œí'),
    "beta"       => Token(TK_ID, 'Œ≤'),
    "Gamma"      => Token(TK_ID, 'Œì'),
    "gamma"      => Token(TK_ID, 'Œ≥'),
    "digamma"    => Token(TK_ID, 'œù'),
    "Delta"      => Token(TK_ID, 'Œî'),
    "delta"      => Token(TK_ID, 'Œ¥'),
    "Epsilon"    => Token(TK_ID, 'Œï'),
    "epsilon"    => Token(TK_ID, 'œµ'),
    "varepsilon" => Token(TK_ID, 'Œµ'),
    "Zeta"       => Token(TK_ID, 'Œñ'),
    "zeta"       => Token(TK_ID, 'Œ∂'),
    "Eta"        => Token(TK_ID, 'Œó'),
    "eta"        => Token(TK_ID, 'Œ∑'),
    "Theta"      => Token(TK_ID, 'Œò'),
    "theta"      => Token(TK_ID, 'Œ∏'),
    "vartheta"   => Token(TK_ID, 'œë'),
    "Iota"       => Token(TK_ID, 'Œô'),
    "iota"       => Token(TK_ID, 'Œπ'),
    "Kappa"      => Token(TK_ID, 'Œö'),
    "kappa"      => Token(TK_ID, 'Œ∫'),
    "Lambda"     => Token(TK_ID, 'Œõ'),
    "lambda"     => Token(TK_ID, 'Œª'),
    "Mu"         => Token(TK_ID, 'Œú'),
    "mu"         => Token(TK_ID, 'Œº'),
    "Nu"         => Token(TK_ID, 'Œù'),
    "nu"         => Token(TK_ID, 'ŒΩ'),
    "Xi"         => Token(TK_ID, 'Œû'),
    "xi"         => Token(TK_ID, 'Œæ'),
    "Omicron"    => Token(TK_ID, 'Œü'),
    "omicron"    => Token(TK_ID, 'Œø'),
    "Pi"         => Token(TK_ID, 'Œ†'),
    "pi"         => Token(TK_ID, 'œÄ'),
    "varpi"      => Token(TK_ID, 'œñ'),
    "Rho"        => Token(TK_ID, 'Œ°'),
    "rho"        => Token(TK_ID, 'œÅ'),
    "varrho"     => Token(TK_ID, 'œ±'),
    "Sigma"      => Token(TK_ID, 'Œ£'),
    "sigma"      => Token(TK_ID, 'œÉ'),
    "varsigma"   => Token(TK_ID, 'œÇ'),
    "Tau"        => Token(TK_ID, 'Œ§'),
    "tau"        => Token(TK_ID, 'œÑ'),
    "Upsilon"    => Token(TK_ID, 'Œ•'),
    "upsilon"    => Token(TK_ID, 'œÖ'),
    "Phi"        => Token(TK_ID, 'Œ¶'),
    "phi"        => Token(TK_ID, 'œï'),
    "varphi"     => Token(TK_ID, 'œÜ'),
    "Chi"        => Token(TK_ID, 'Œß'),
    "chi"        => Token(TK_ID, 'œá'),
    "Psi"        => Token(TK_ID, 'Œ®'),
    "psi"        => Token(TK_ID, 'œà'),
    "Omega"      => Token(TK_ID, 'Œ©'),
    "omega"      => Token(TK_ID, 'œâ'),
    "aleph"      => Token(TK_ID, '‚Ñµ'),
    "O"          => Token(TK_ID, '√ò'),
    "o"          => Token(TK_ID, '√∏'),
    "ss"         => Token(TK_ID, '√ü'),
    "imath"      => Token(TK_ID, 'ƒ±'),
    "jmath"      => Token(TK_ID, '»∑'),
    "ell"        => Token(TK_ID, '‚Ñì'),
    "hbar"       => Token(TK_ID, '‚Ñè'),
    "hslash"     => Token(TK_ID, '‚Ñè'),
    "infty"      => Token(TK_ID, '‚àû'),
    "Re"         => Token(TK_ID, '‚Ñú'),
    "Im"         => Token(TK_ID, '‚Ñë'),
    "complement" => Token(TK_ID, '‚àÅ'),
    "emptyset"   => Token(TK_ID, '‚àÖ'),
    "therefore"  => Token(TK_ID, '‚à¥'),
    "because"    => Token(TK_ID, '‚àµ'),
    "Diamond"    => Token(TK_ID, '‚óä'),
    "Box"        => Token(TK_ID, '‚óª'),
    "triangle"   => Token(TK_ID, '‚ñ≥'),
    "angle"      => Token(TK_ID, '‚à†'),
    # function names
    "sin"        => Token(TK_FUN, "sin"),
    "cos"        => Token(TK_FUN, "cos"),
    "tan"        => Token(TK_FUN, "tan"),
    "csc"        => Token(TK_FUN, "csc"),
    "sec"        => Token(TK_FUN, "sec"),
    "cot"        => Token(TK_FUN, "cot"),
    "arcsin"     => Token(TK_FUN, "arcsin"),
    "arccos"     => Token(TK_FUN, "arccos"),
    "arctan"     => Token(TK_FUN, "arctan"),
    "sinh"       => Token(TK_FUN, "sinh"),
    "cosh"       => Token(TK_FUN, "cosh"),
    "tanh"       => Token(TK_FUN, "tanh"),
    "coth"       => Token(TK_FUN, "coth"),
    "exp"        => Token(TK_FUN, "exp"),
    "ln"         => Token(TK_FUN, "ln"),
    "log"        => Token(TK_FUN, "log"),
    "erf"        => Token(TK_FUN, "erf"),
    "erfc"       => Token(TK_FUN, "erfc"),
    "arg"        => Token(TK_FUN, "arg"),
    "ker"        => Token(TK_FUN, "ker"),
    "dim"        => Token(TK_FUN, "dim"),
    "det"        => Token(TK_FUN, "det"),
    # operators, mostly infix, some are prefix
    "times"              => Token(TK_OPID, '√ó'),
    "oplus"              => Token(TK_OPID, '‚äï'),
    "ominus"             => Token(TK_OPID, '‚äñ'),
    "otimes"             => Token(TK_OPID, '‚äó'),
    "oslash"             => Token(TK_OPID, '‚äò'),
    "odot"               => Token(TK_OPID, '‚äô'),
    "bigcirc"            => Token(TK_OPID, '‚óØ'),
    "amalg"              => Token(TK_OPID, '‚®ø'),
    "pm"                 => Token(TK_OPID, '¬±'),
    "mp"                 => Token(TK_OPID, '‚àì'),
    "cdot"               => Token(TK_OPID, '¬∑'),
    "cdots"              => Token(TK_OPID, '‚ãØ'),
    "vdots"              => Token(TK_OPID, '‚ãÆ'),
    "ldots"              => Token(TK_OPID, '‚Ä¶'),
    "ddots"              => Token(TK_OPID, '‚ã±'),
    "circ"               => Token(TK_OPID, '‚àò'),
    "bullet"             => Token(TK_OPID, '‚àô'),
    "star"               => Token(TK_OPID, '‚ãÜ'),
    "div"                => Token(TK_OPID, '√∑'),
    "lnot"               => Token(TK_OPID, '¬¨'),
    "land"               => Token(TK_OPID, '‚àß'),
    "lor"                => Token(TK_OPID, '‚à®'),
    "sim"                => Token(TK_OPID, '‚àº'),
    "simeq"              => Token(TK_OPID, '‚âÉ'),
    "nsim"               => Token(TK_OPID, '‚âÅ'),
    "cong"               => Token(TK_OPID, '‚âÖ'),
    "approx"             => Token(TK_OPID, '‚âà'),
    "ne"                 => Token(TK_OPID, '‚â†'),
    "neq"                => Token(TK_OPID, '‚â†'),
    "equiv"              => Token(TK_OPID, '‚â°'),
    "nequiv"             => Token(TK_OPID, '‚â¢'),
    "prec"               => Token(TK_OPID, '‚â∫'),
    "succ"               => Token(TK_OPID, '‚âª'),
    "preceq"             => Token(TK_OPID, '‚™Ø'),
    "succeq"             => Token(TK_OPID, '‚™∞'),
    "dashv"              => Token(TK_OPID, '‚ä£'),
    "asymp"              => Token(TK_OPID, '‚âç'),
    "doteq"              => Token(TK_OPID, '‚âê'),
    "propto"             => Token(TK_OPID, '‚àù'),
    "barwedge"           => Token(TK_OPID, '‚äº'),
    "ltimes"             => Token(TK_OPID, '‚ãâ'),
    "rtimes"             => Token(TK_OPID, '‚ãä'),
    "Join"               => Token(TK_OPID, '‚ãà'),
    "lhd"                => Token(TK_OPID, '‚ä≤'),
    "rhd"                => Token(TK_OPID, '‚ä≥'),
    "unlhd"              => Token(TK_OPID, '‚ä¥'),
    "unrhd"              => Token(TK_OPID, '‚äµ'),
    "vee"                => Token(TK_OPID, '‚à®'),
    "uplus"              => Token(TK_OPID, '‚äé'),
    "wedge"              => Token(TK_OPID, '‚àß'),
    "veebar"             => Token(TK_OPID, '‚äª'),
    "cap"                => Token(TK_OPID, '‚à©'),
    "cup"                => Token(TK_OPID, '‚à™'),
    "mid"                => Token(TK_OPID, '‚à£'),
    "nmid"               => Token(TK_OPID, '‚à§'),
    "parallel"           => Token(TK_OPID, '‚à•'),
    "perp"               => Token(TK_OPID, '‚ä•'),
    "forall"             => Token(TK_OPID, '‚àÄ'),
    "exists"             => Token(TK_OPID, '‚àÉ'),
    "nexists"            => Token(TK_OPID, '‚àÑ'),
    "lt"                 => Token(TK_OPID, '<'),
    "gt"                 => Token(TK_OPID, '>'),
    "leq"                => Token(TK_OPID, '‚â§'),
    "geq"                => Token(TK_OPID, '‚â•'),
    "ll"                 => Token(TK_OPID, '‚â™'),
    "gg"                 => Token(TK_OPID, '‚â´'),
    "lessapprox"         => Token(TK_OPID, '‚™Ö'),
    "lesssim"            => Token(TK_OPID, '‚â≤'),
    "eqslantless"        => Token(TK_OPID, '‚™ï'),
    "leqslant"           => Token(TK_OPID, '‚©Ω'),
    "leqq"               => Token(TK_OPID, '‚â¶'),
    "geqq"               => Token(TK_OPID, '‚âß'),
    "geqslant"           => Token(TK_OPID, '‚©æ'),
    "eqslantgtr"         => Token(TK_OPID, '‚™ñ'),
    "gtrsim"             => Token(TK_OPID, '‚â≥'),
    "gtrapprox"          => Token(TK_OPID, '‚™Ü'),
    "approxeq"           => Token(TK_OPID, '‚âä'),
    "lessdot"            => Token(TK_OPID, '‚ãñ'),
    "lll"                => Token(TK_OPID, '‚ãò'),
    "lessgtr"            => Token(TK_OPID, '‚â∂'),
    "lesseqgtr"          => Token(TK_OPID, '‚ãö'),
    "lesseqqgtr"         => Token(TK_OPID, '‚™ã'),
    "doteqdot"           => Token(TK_OPID, '‚âë'),
    "leftarrow"          => Token(TK_OPID, '‚Üê'),
    "gets"               => Token(TK_OPID, '‚Üê'),
    "rightarrow"         => Token(TK_OPID, '‚Üí'),
    "to"                 => Token(TK_OPID, '‚Üí'),
    "nleftarrow"         => Token(TK_OPID, '‚Üö'),
    "nrightarrow"        => Token(TK_OPID, '‚Üõ'),
    "leftrightarrow"     => Token(TK_OPID, '‚Üî'),
    "nleftrightarrow"    => Token(TK_OPID, '‚ÜÆ'),
    "longleftarrow"      => Token(TK_OPID, '‚üµ'),
    "longrightarrow"     => Token(TK_OPID, '‚ü∂'),
    "longleftrightarrow" => Token(TK_OPID, '‚ü∑'),
    "Leftarrow"          => Token(TK_OPID, '‚áê'),
    "Rightarrow"         => Token(TK_OPID, '‚áí'),
    "nLeftarrow"         => Token(TK_OPID, '‚áç'),
    "nRightarrow"        => Token(TK_OPID, '‚áè'),
    "uparrow"            => Token(TK_OPID, '‚Üë'),
    "downarrow"          => Token(TK_OPID, '‚Üì'),
    "updownarrow"        => Token(TK_OPID, '‚Üï'),
    "in"                 => Token(TK_OPID, '‚àà'),
    "ni"                 => Token(TK_OPID, '‚àâ'),
    "notin"              => Token(TK_OPID, '‚àâ'),
    "subset"             => Token(TK_OPID, '‚äÇ'),
    "supset"             => Token(TK_OPID, '‚äÉ'),
    "subseteq"           => Token(TK_OPID, '‚äÜ'),
    "supseteq"           => Token(TK_OPID, '‚äá'),
    "nsubseteq"          => Token(TK_OPID, '‚äà'),
    "nsupseteq"          => Token(TK_OPID, '‚äâ'),
    "subsetneq"          => Token(TK_OPID, '‚ää'),
    "supsetneq"          => Token(TK_OPID, '‚äã'),
    "sqsubset"           => Token(TK_OPID, '‚äè'),
    "sqsubseteq"         => Token(TK_OPID, '‚äë'),
    "sqsupset"           => Token(TK_OPID, '‚äê'),
    "sqsupseteq"         => Token(TK_OPID, '‚äí'),
    "sqcap"              => Token(TK_OPID, '‚äì'),
    "sqcup"              => Token(TK_OPID, '‚äî'),
    "setminus"           => Token(TK_OPID, '‚àñ'),
    "partial"            => Token(TK_OPID, '‚àÇ'),
    "nabla"              => Token(TK_OPID, '‚àá'),
    "__final__"  => Token(TK_ID, "__final__")
   )

const unicode_to_optoken = Dict(
    # integrals and big operators
    '‚à´' => Token(TK_INT, '‚à´'),
    '‚à¨' => Token(TK_INT, '‚à¨'),
    '‚à≠' => Token(TK_INT, '‚à≠'),
    '‚àÆ' => Token(TK_INT, '‚àÆ'),
    '‚àë' => Token(TK_BIGOP, '‚àë'),
    '‚àè' => Token(TK_BIGOP, '‚àè'),
    '‚àê' => Token(TK_BIGOP, '‚àê'),
    '‚ãÇ' => Token(TK_BIGOP, '‚ãÇ'),
    '‚ãÉ' => Token(TK_BIGOP, '‚ãÉ'),
    '‚®Ü' => Token(TK_BIGOP, '‚®Ü'),
    '‚ãÅ' => Token(TK_BIGOP, '‚ãÅ'),
    '‚ãÄ' => Token(TK_BIGOP, '‚ãÄ'),
    '‚®Ä' => Token(TK_BIGOP, '‚®Ä'),
    '‚®Ç' => Token(TK_BIGOP, '‚®Ç'),
    '‚®Å' => Token(TK_BIGOP, '‚®Å'),
    '‚®Ñ' => Token(TK_BIGOP, '‚®Ñ'),
    # operators
    '√ó' => Token(TK_OPID, '√ó'),
    '‚äï' => Token(TK_OPID, '‚äï'),
    '‚äñ' => Token(TK_OPID, '‚äñ'),
    '‚äó' => Token(TK_OPID, '‚äó'),
    '‚äò' => Token(TK_OPID, '‚äò'),
    '‚äô' => Token(TK_OPID, '‚äô'),
    '‚óØ' => Token(TK_OPID, '‚óØ'),
    '‚®ø' => Token(TK_OPID, '‚®ø'),
    '¬±' => Token(TK_OPID, '¬±'),
    '‚àì' => Token(TK_OPID, '‚àì'),
    '¬∑' => Token(TK_OPID, '¬∑'),
    '‚ãØ' => Token(TK_OPID, '‚ãØ'),
    '‚ãÆ' => Token(TK_OPID, '‚ãÆ'),
    '‚Ä¶' => Token(TK_OPID, '‚Ä¶'),
    '‚ã±' => Token(TK_OPID, '‚ã±'),
    '‚àò' => Token(TK_OPID, '‚àò'),
    '‚àô' => Token(TK_OPID, '‚àô'),
    '‚ãÜ' => Token(TK_OPID, '‚ãÜ'),
    '√∑' => Token(TK_OPID, '√∑'),
    '¬¨' => Token(TK_OPID, '¬¨'),
    '‚àß' => Token(TK_OPID, '‚àß'),
    '‚à®' => Token(TK_OPID, '‚à®'),
    '‚àº' => Token(TK_OPID, '‚àº'),
    '‚âÉ' => Token(TK_OPID, '‚âÉ'),
    '‚âÅ' => Token(TK_OPID, '‚âÅ'),
    '‚âÖ' => Token(TK_OPID, '‚âÖ'),
    '‚âà' => Token(TK_OPID, '‚âà'),
    '‚â†' => Token(TK_OPID, '‚â†'),
    '‚â†' => Token(TK_OPID, '‚â†'),
    '‚â°' => Token(TK_OPID, '‚â°'),
    '‚â¢' => Token(TK_OPID, '‚â¢'),
    '‚â∫' => Token(TK_OPID, '‚â∫'),
    '‚âª' => Token(TK_OPID, '‚âª'),
    '‚™Ø' => Token(TK_OPID, '‚™Ø'),
    '‚™∞' => Token(TK_OPID, '‚™∞'),
    '‚ä£' => Token(TK_OPID, '‚ä£'),
    '‚âç' => Token(TK_OPID, '‚âç'),
    '‚âê' => Token(TK_OPID, '‚âê'),
    '‚àù' => Token(TK_OPID, '‚àù'),
    '‚äº' => Token(TK_OPID, '‚äº'),
    '‚ãâ' => Token(TK_OPID, '‚ãâ'),
    '‚ãä' => Token(TK_OPID, '‚ãä'),
    '‚ãà' => Token(TK_OPID, '‚ãà'),
    '‚ä≤' => Token(TK_OPID, '‚ä≤'),
    '‚ä≥' => Token(TK_OPID, '‚ä≥'),
    '‚ä¥' => Token(TK_OPID, '‚ä¥'),
    '‚äµ' => Token(TK_OPID, '‚äµ'),
    '‚à®' => Token(TK_OPID, '‚à®'),
    '‚äé' => Token(TK_OPID, '‚äé'),
    '‚àß' => Token(TK_OPID, '‚àß'),
    '‚äª' => Token(TK_OPID, '‚äª'),
    '‚à©' => Token(TK_OPID, '‚à©'),
    '‚à™' => Token(TK_OPID, '‚à™'),
    '‚à£' => Token(TK_OPID, '‚à£'),
    '‚à§' => Token(TK_OPID, '‚à§'),
    '‚à•' => Token(TK_OPID, '‚à•'),
    '‚ä•' => Token(TK_OPID, '‚ä•'),
    '‚àÄ' => Token(TK_OPID, '‚àÄ'),
    '‚àÉ' => Token(TK_OPID, '‚àÉ'),
    '‚àÑ' => Token(TK_OPID, '‚àÑ'),
    '<' => Token(TK_OPID, '<'),
    '>' => Token(TK_OPID, '>'),
    '‚â§' => Token(TK_OPID, '‚â§'),
    '‚â•' => Token(TK_OPID, '‚â•'),
    '‚â™' => Token(TK_OPID, '‚â™'),
    '‚â´' => Token(TK_OPID, '‚â´'),
    '‚™Ö' => Token(TK_OPID, '‚™Ö'),
    '‚â≤' => Token(TK_OPID, '‚â≤'),
    '‚™ï' => Token(TK_OPID, '‚™ï'),
    '‚©Ω' => Token(TK_OPID, '‚©Ω'),
    '‚â¶' => Token(TK_OPID, '‚â¶'),
    '‚âß' => Token(TK_OPID, '‚âß'),
    '‚©æ' => Token(TK_OPID, '‚©æ'),
    '‚™ñ' => Token(TK_OPID, '‚™ñ'),
    '‚â≥' => Token(TK_OPID, '‚â≥'),
    '‚™Ü' => Token(TK_OPID, '‚™Ü'),
    '‚âä' => Token(TK_OPID, '‚âä'),
    '‚ãñ' => Token(TK_OPID, '‚ãñ'),
    '‚ãò' => Token(TK_OPID, '‚ãò'),
    '‚â∂' => Token(TK_OPID, '‚â∂'),
    '‚ãö' => Token(TK_OPID, '‚ãö'),
    '‚™ã' => Token(TK_OPID, '‚™ã'),
    '‚âë' => Token(TK_OPID, '‚âë'),
    '‚Üê' => Token(TK_OPID, '‚Üê'),
    '‚Üê' => Token(TK_OPID, '‚Üê'),
    '‚Üí' => Token(TK_OPID, '‚Üí'),
    '‚Üí' => Token(TK_OPID, '‚Üí'),
    '‚Üö' => Token(TK_OPID, '‚Üö'),
    '‚Üõ' => Token(TK_OPID, '‚Üõ'),
    '‚Üî' => Token(TK_OPID, '‚Üî'),
    '‚ÜÆ' => Token(TK_OPID, '‚ÜÆ'),
    '‚üµ' => Token(TK_OPID, '‚üµ'),
    '‚ü∂' => Token(TK_OPID, '‚ü∂'),
    '‚ü∑' => Token(TK_OPID, '‚ü∑'),
    '‚áê' => Token(TK_OPID, '‚áê'),
    '‚áí' => Token(TK_OPID, '‚áí'),
    '‚áç' => Token(TK_OPID, '‚áç'),
    '‚áè' => Token(TK_OPID, '‚áè'),
    '‚Üë' => Token(TK_OPID, '‚Üë'),
    '‚Üì' => Token(TK_OPID, '‚Üì'),
    '‚Üï' => Token(TK_OPID, '‚Üï'),
    '‚àà' => Token(TK_OPID, '‚àà'),
    '‚àâ' => Token(TK_OPID, '‚àâ'),
    '‚àâ' => Token(TK_OPID, '‚àâ'),
    '‚äÇ' => Token(TK_OPID, '‚äÇ'),
    '‚äÉ' => Token(TK_OPID, '‚äÉ'),
    '‚äÜ' => Token(TK_OPID, '‚äÜ'),
    '‚äá' => Token(TK_OPID, '‚äá'),
    '‚äà' => Token(TK_OPID, '‚äà'),
    '‚äâ' => Token(TK_OPID, '‚äâ'),
    '‚ää' => Token(TK_OPID, '‚ää'),
    '‚äã' => Token(TK_OPID, '‚äã'),
    '‚äè' => Token(TK_OPID, '‚äè'),
    '‚äë' => Token(TK_OPID, '‚äë'),
    '‚äê' => Token(TK_OPID, '‚äê'),
    '‚äí' => Token(TK_OPID, '‚äí'),
    '‚äì' => Token(TK_OPID, '‚äì'),
    '‚äî' => Token(TK_OPID, '‚äî'),
    '‚àñ' => Token(TK_OPID, '‚àñ'),
    '‚àÇ' => Token(TK_OPID, '‚àÇ'),
    '‚àá' => Token(TK_OPID, '‚àá')
)

const _to_mathbf = Dict(
    "A" => "ùêÄ",  # mathematical bold capital a
    "B" => "ùêÅ",  # mathematical bold capital b
    "C" => "ùêÇ",  # mathematical bold capital c
    "D" => "ùêÉ",  # mathematical bold capital d
    "E" => "ùêÑ",  # mathematical bold capital e
    "F" => "ùêÖ",  # mathematical bold capital f
    "G" => "ùêÜ",  # mathematical bold capital g
    "H" => "ùêá",  # mathematical bold capital h
    "I" => "ùêà",  # mathematical bold capital i
    "J" => "ùêâ",  # mathematical bold capital j
    "K" => "ùêä",  # mathematical bold capital k
    "L" => "ùêã",  # mathematical bold capital l
    "M" => "ùêå",  # mathematical bold capital m
    "N" => "ùêç",  # mathematical bold capital n
    "O" => "ùêé",  # mathematical bold capital o
    "P" => "ùêè",  # mathematical bold capital p
    "Q" => "ùêê",  # mathematical bold capital q
    "R" => "ùêë",  # mathematical bold capital r
    "S" => "ùêí",  # mathematical bold capital s
    "T" => "ùêì",  # mathematical bold capital t
    "U" => "ùêî",  # mathematical bold capital u
    "V" => "ùêï",  # mathematical bold capital v
    "W" => "ùêñ",  # mathematical bold capital w
    "X" => "ùêó",  # mathematical bold capital x
    "Y" => "ùêò",  # mathematical bold capital y
    "Z" => "ùêô",  # mathematical bold capital z
    "a" => "ùêö",  # mathematical bold small a
    "b" => "ùêõ",  # mathematical bold small b
    "c" => "ùêú",  # mathematical bold small c
    "d" => "ùêù",  # mathematical bold small d
    "e" => "ùêû",  # mathematical bold small e
    "f" => "ùêü",  # mathematical bold small f
    "g" => "ùê†",  # mathematical bold small g
    "h" => "ùê°",  # mathematical bold small h
    "i" => "ùê¢",  # mathematical bold small i
    "j" => "ùê£",  # mathematical bold small j
    "k" => "ùê§",  # mathematical bold small k
    "l" => "ùê•",  # mathematical bold small l
    "m" => "ùê¶",  # mathematical bold small m
    "n" => "ùêß",  # mathematical bold small n
    "o" => "ùê®",  # mathematical bold small o
    "p" => "ùê©",  # mathematical bold small p
    "q" => "ùê™",  # mathematical bold small q
    "r" => "ùê´",  # mathematical bold small r
    "s" => "ùê¨",  # mathematical bold small s
    "t" => "ùê≠",  # mathematical bold small t
    "u" => "ùêÆ",  # mathematical bold small u
    "v" => "ùêØ",  # mathematical bold small v
    "w" => "ùê∞",  # mathematical bold small w
    "x" => "ùê±",  # mathematical bold small x
    "y" => "ùê≤",  # mathematical bold small y
    "z" => "ùê≥"   # mathematical bold small z
    )
const _to_mathcal = Dict(
    "A" => "ùíú",  # mathematical script capital a
    "B" => "‚Ñ¨",  # mathematical script capital b
    "C" => "ùíû",  # mathematical script capital c
    "D" => "ùíü",  # mathematical script capital d
    "E" => "‚Ñ∞",  # mathematical script capital e
    "F" => "‚Ñ±",  # mathematical script capital f
    "G" => "ùí¢",  # mathematical script capital g
    "H" => "‚Ñã",  # mathematical script capital h
    "I" => "‚Ñê",  # mathematical script capital i
    "J" => "ùí•",  # mathematical script capital j
    "K" => "ùí¶",  # mathematical script capital k
    "L" => "‚Ñí",  # mathematical script capital l
    "M" => "‚Ñ≥",  # mathematical script capital m
    "N" => "ùí©",  # mathematical script capital n
    "O" => "ùí™",  # mathematical script capital o
    "P" => "ùí´",  # mathematical script capital p
    "Q" => "ùí¨",  # mathematical script capital q
    "R" => "‚Ñõ",  # mathematical script capital r
    "S" => "ùíÆ",  # mathematical script capital s
    "T" => "ùíØ",  # mathematical script capital t
    "U" => "ùí∞",  # mathematical script capital u
    "V" => "ùí±",  # mathematical script capital v
    "W" => "ùí≤",  # mathematical script capital w
    "X" => "ùí≥",  # mathematical script capital x
    "Y" => "ùí¥",  # mathematical script capital y
    "Z" => "ùíµ",  # mathematical script capital z
    "a" => "ùí∂",  # mathematical script small a
    "b" => "ùí∑",  # mathematical script small b
    "c" => "ùí∏",  # mathematical script small c
    "d" => "ùíπ",  # mathematical script small d
    "e" => "‚ÑØ",  # mathematical script small e
    "f" => "ùíª",  # mathematical script small f
    "g" => "‚Ñä",  # mathematical script small g
    "h" => "ùíΩ",  # mathematical script small h
    "i" => "ùíæ",  # mathematical script small i
    "j" => "ùíø",  # mathematical script small j
    "k" => "ùìÄ",  # mathematical script small k
    "l" => "ùìÅ",  # mathematical script small l
    "m" => "ùìÇ",  # mathematical script small m
    "n" => "ùìÉ",  # mathematical script small n
    "o" => "‚Ñ¥",  # mathematical script small o
    "p" => "ùìÖ",  # mathematical script small p
    "q" => "ùìÜ",  # mathematical script small q
    "r" => "ùìá",  # mathematical script small r
    "s" => "ùìà",  # mathematical script small s
    "t" => "ùìâ",  # mathematical script small t
    "u" => "ùìä",  # mathematical script small u
    "v" => "ùìã",  # mathematical script small v
    "w" => "ùìå",  # mathematical script small w
    "x" => "ùìç",  # mathematical script small x
    "y" => "ùìé",  # mathematical script small y
    "z" => "ùìè"   # mathematical script small z
    )

const _to_mathfrak = Dict(
    "A" => "ùîÑ",  # mathematical fraktur capital a
    "B" => "ùîÖ",  # mathematical fraktur capital b
    "C" => "‚Ñ≠",  # mathematical fraktur capital c
    "D" => "ùîá",  # mathematical fraktur capital d
    "E" => "ùîà",  # mathematical fraktur capital e
    "F" => "ùîâ",  # mathematical fraktur capital f
    "G" => "ùîä",  # mathematical fraktur capital g
    "H" => "‚Ñå",  # mathematical fraktur capital h
    "I" => "ùï¥",  # mathematical fraktur capital i (bold)
    "J" => "ùîç",  # mathematical fraktur capital j
    "K" => "ùîé",  # mathematical fraktur capital k
    "L" => "ùîè",  # mathematical fraktur capital l
    "M" => "ùîê",  # mathematical fraktur capital m
    "N" => "ùîë",  # mathematical fraktur capital n
    "O" => "ùîí",  # mathematical fraktur capital o
    "P" => "ùîì",  # mathematical fraktur capital p
    "Q" => "ùîî",  # mathematical fraktur capital q
    "R" => "ùïΩ",  # mathematical fraktur capital r (bold)
    "S" => "ùîñ",  # mathematical fraktur capital s
    "T" => "ùîó",  # mathematical fraktur capital t
    "U" => "ùîò",  # mathematical fraktur capital u
    "V" => "ùîô",  # mathematical fraktur capital v
    "W" => "ùîö",  # mathematical fraktur capital w
    "X" => "ùîõ",  # mathematical fraktur capital x
    "Y" => "ùîú",  # mathematical fraktur capital y
    "Z" => "‚Ñ®",  # mathematical fraktur capital z
    "a" => "ùîû",  # mathematical fraktur small a
    "b" => "ùîü",  # mathematical fraktur small b
    "c" => "ùî†",  # mathematical fraktur small c
    "d" => "ùî°",  # mathematical fraktur small d
    "e" => "ùî¢",  # mathematical fraktur small e
    "f" => "ùî£",  # mathematical fraktur small f
    "g" => "ùî§",  # mathematical fraktur small g
    "h" => "ùî•",  # mathematical fraktur small h
    "i" => "ùî¶",  # mathematical fraktur small i
    "j" => "ùîß",  # mathematical fraktur small j
    "k" => "ùî®",  # mathematical fraktur small k
    "l" => "ùî©",  # mathematical fraktur small l
    "m" => "ùî™",  # mathematical fraktur small m
    "n" => "ùî´",  # mathematical fraktur small n
    "o" => "ùî¨",  # mathematical fraktur small o
    "p" => "ùî≠",  # mathematical fraktur small p
    "q" => "ùîÆ",  # mathematical fraktur small q
    "r" => "ùîØ",  # mathematical fraktur small r
    "s" => "ùî∞",  # mathematical fraktur small s
    "t" => "ùî±",  # mathematical fraktur small t
    "u" => "ùî≤",  # mathematical fraktur small u
    "v" => "ùî≥",  # mathematical fraktur small v
    "w" => "ùî¥",  # mathematical fraktur small w
    "x" => "ùîµ",  # mathematical fraktur small x
    "y" => "ùî∂",  # mathematical fraktur small y
    "z" => "ùî∑"   # mathematical fraktur small z
    )
const _to_mathbb = Dict(
    "A" => "ùî∏",  # mathematical double-struck capital a
    "B" => "ùîπ",  # mathematical double-struck capital b
    "C" => "‚ÑÇ",  # mathematical double-struck capital c
    "D" => "ùîª",  # mathematical double-struck capital d
    "E" => "ùîº",  # mathematical double-struck capital e
    "F" => "ùîΩ",  # mathematical double-struck capital f
    "G" => "ùîæ",  # mathematical double-struck capital g
    "H" => "‚Ñç",  # mathematical double-struck capital h
    "I" => "ùïÄ",  # mathematical double-struck capital i
    "J" => "ùïÅ",  # mathematical double-struck capital j
    "K" => "ùïÇ",  # mathematical double-struck capital k
    "L" => "ùïÉ",  # mathematical double-struck capital l
    "M" => "ùïÑ",  # mathematical double-struck capital m
    "N" => "‚Ñï",  # mathematical double-struck capital o
    "O" => "ùïÜ",  # mathematical double-struck capital o
    "P" => "‚Ñô",  # mathematical double-struck capital p
    "Q" => "‚Ñö",  # mathematical double-struck capital q
    "R" => "‚Ñù",  # mathematical double-struck capital r
    "S" => "ùïä",  # mathematical double-struck capital s
    "T" => "ùïã",  # mathematical double-struck capital t
    "U" => "ùïå",  # mathematical double-struck capital u
    "V" => "ùïç",  # mathematical double-struck capital v
    "W" => "ùïé",  # mathematical double-struck capital w
    "X" => "ùïè",  # mathematical double-struck capital x
    "Y" => "ùïê",  # mathematical double-struck capital y
    "Z" => "‚Ñ§",  # mathematical double-struck capital z
    "a" => "ùïí",  # mathematical double-struck small a
    "b" => "ùïì",  # mathematical double-struck small b
    "c" => "ùïî",  # mathematical double-struck small c
    "d" => "ùïï",  # mathematical double-struck small d
    "e" => "ùïñ",  # mathematical double-struck small e
    "f" => "ùïó",  # mathematical double-struck small f
    "g" => "ùïò",  # mathematical double-struck small g
    "h" => "ùïô",  # mathematical double-struck small h
    "i" => "ùïö",  # mathematical double-struck small i
    "j" => "ùïõ",  # mathematical double-struck small j
    "k" => "ùïú",  # mathematical double-struck small k
    "l" => "ùïù",  # mathematical double-struck small l
    "m" => "ùïû",  # mathematical double-struck small m
    "n" => "ùïü",  # mathematical double-struck small n
    "o" => "ùï†",  # mathematical double-struck small o
    "p" => "ùï°",  # mathematical double-struck small p
    "q" => "ùï¢",  # mathematical double-struck small q
    "r" => "ùï£",  # mathematical double-struck small r
    "s" => "ùï§",  # mathematical double-struck small s
    "t" => "ùï•",  # mathematical double-struck small t
    "u" => "ùï¶",  # mathematical double-struck small u
    "v" => "ùïß",  # mathematical double-struck small v
    "w" => "ùï®",  # mathematical double-struck small w
    "x" => "ùï©",  # mathematical double-struck small x
    "y" => "ùï™",  # mathematical double-struck small y
    "z" => "ùï´"   # mathematical double-struck small z
    )

const LETTER_TRANSLATION = Dict(
    "mathbf"    => _to_mathbf,
    "mathcal"   => _to_mathcal,
    "mathbb"    => _to_mathbb,
    "mathfrak"  => _to_mathfrak
    )

# this dictionary is for printing token names in debug
const token_names = Dict(
    TK_ID           =>   "TK_ID         ", 
    TK_NUM          =>   "TK_NUM        ", 
    #TK_SYM         =>   "TK_SYM        ", 
    TK_FUN          =>   "TK_FUN        ", 
    #TK_CMD         =>   "TK_CMD        ", 
    TK_ENV          =>   "TK_ENV        ", 
    TK_OPID         =>   "TK_OPID       ", 
    #TK_OPID2       =>   "TK_OPID2      ", 
    TK_LIM          =>   "TK_LIM        ",       
    TK_INT          =>   "TK_INT        ",    
    TK_BIGOP        =>   "TK_BIGOP      ", 
    TK_LBRACE       =>   "TK_LBRACE     ", 
    TK_RBRACE       =>   "TK_RBRACE     ", 
    TK_SUB          =>   "TK_SUB        ", 
    TK_SUP          =>   "TK_SUP        ", 
    TK_AMP          =>   "TK_AMP        ", 
    TK_NEWLINE      =>   "TK_NEWLINE    ", 
    TK_TEXT         =>   "TK_TEXT       ", 
    TK_SQRT         =>   "TK_SQRT       ", 
    TK_FRAC         =>   "TK_FRAC       ", 
    TK_LEFT         =>   "TK_LEFT       ", 
    TK_RIGHT        =>   "TK_RIGHT      ", 
    TK_MIDDLE       =>   "TK_MIDDLE     ", 
    TK_BEGIN        =>   "TK_BEGIN      ", 
    TK_END          =>   "TK_END        ", 
    TK_BINOM        =>   "TK_BINOM      ", 
    TK_OVERSET      =>   "TK_OVERSET    ", 
    TK_UNDERSET     =>   "TK_UNDERSET   ", 
    TK_OVERBRACE    =>   "TK_OVERBRACE  ", 
    TK_UNDERBRACE   =>   "TK_UNDERBRACE ", 
    TK_OVERACCENT   =>   "TK_OVERACCENT ", 
    TK_UNDERACCENT  =>   "TK_UNDERACCENT",
    TK_SPACE        =>   "TK_SPACE      ",
    TK_BIG          =>   "TK_BIG        ", 
    TK_PAREN        =>   "TK_PAREN      ", 
    TK_ENV_NAME     =>   "TK_ENV_NAME   ",
    TK_ENV_ATTR     =>   "TK_ENV_ATTR   ",
    TK_OPNAME       =>   "TK_OPNAME     ",
    TK_STYLE        =>   "TK_STYLE      ",
    TK_IGSTYLE      =>   "TK_IGSTYLE    ",
    TK_UNKNOWN      =>   "TK_UNKNOWN    "
   )


